<html>
<head>

<script src=./jq.js ></script>
<script>
$(document).ready(function () { 
    webSocket = new WebSocket("ws://localhost:8765");


webSocket.onmessage = ({data}) => {
    all_uri = [];
    i=0;
    console.log(event.data);
    message = document.createElement("div");
    document.body.appendChild(message)
    json = JSON.parse(data)
    console.log(json)
    const uri = json.uri;
    all_uri.push(uri)
    const res = uri.split("/")
    url = "https://bsky.app/profile/" + res[2] + "/post/" + res[4]
    message.innerHTML = message.innerHTML + "<a href=" + url + ">" + url +"</a><br/>";

    const content = document.createTextNode(json["record"]["text"]);
    message.appendChild(content);
    try { 
        json.embed.images.forEach((val, index) => {
            img = document.createElement("img")
            img.src=val["fullsize"];
            message.appendChild(img);
            message.innerHTML = message.innerHTML + "<br>"
       })
    } catch {
    }
    message.innerHTML = message.innerHTML + "<br>"
    message.innerHTML = message.innerHTML + "<button onClick='var xhr = new XMLHttpRequest(); xhr.open(\"GET\",\"http://127.0.0.1:5000/spam/" + encodeURIComponent(json.uri) + "/false\");xhr.send()' >HAM</button> "
    message.innerHTML = message.innerHTML + "<button onClick='var xhr = new XMLHttpRequest(); xhr.open(\"GET\",\"http://127.0.0.1:5000/spam/" + encodeURIComponent(json.uri) + "/true\");xhr.send()' >SPAM</button>"
    message.innerHTML = message.innerHTML + "<hr>"
};
$("#a").on("click", () => { console.log("click"); webSocket.send("lol") })


})
</script>
</head>
<body>
<button id=a >Click </button>

</body>
</html>
